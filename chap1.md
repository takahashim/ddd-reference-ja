# I. モデルを活躍させる Putting the Model to Work

ドメイン駆動設計とは、複雑なソフトウェアを開発するためのアプローチで、以下のことを行います:

1. コアドメインに注目する。
2. ドメインの実務家とソフトウェアの実務家との創造的なコラボレーションの中でモデルを探求する。
3. 明示的に境界づけられたコンテキスト内ではユビキタス言語を話す。

DDDのこの3点のまとめは、このブックレットで定義している用語の定義に依存しています。

多くのプロジェクトで行われているモデリング作業は、最終的にはあまり実益をもたらしません。
DDDのパターンは、モデリングによって劇的な利益が得られたプロジェクトの成功事例を抽出したものです。
これらのパターンをまとめると、モデリングとソフトウェア開発に対する、細部の詳細から全体的な洞察までを網羅した、まったく異なるアプローチが示されます。
厳格なモデリングの慣習と、技術者以外の人たちと協力してモデルを自由に探索することとのバランスがとれていなければなりません。成功するためには戦術と戦略を組み合わせなければなりませんが、DDDは戦術的な設計と戦略的な設計の両方を扱っています。

## 境界づけられたコンテキスト Bounded Context

大規模なプロジェクトでは、多数のモデルが存在します。
これらのモデルは、さまざまな理由により生み出されます。

2つのサブシステムは、一般的に、それぞれ異なるジョブを持った異なるユーザーコミュニティを扱っています。そのため、異なるモデルが有用であるかもしれません。
独立して作業しているチームは、コミュニケーションの不足により、同じ問題を異なる方法で解決していることがあります。
また、ツールセットが異なる場合には、プログラムコードを共有することができなくなります。

モデルが複数になることは避けられませんが、異なるモデルに基づいたコードを組み合わせた場合、ソフトウェアはバグだらけになり、信頼性も低くなり、理解しづらいものとなります。
チームメンバー同士のコミュニケーションも混乱します。
どのようなコンテキストでモデルを適用してはいけないのかが不明確になることがよくあります。

モデル表現は、他のフレーズと同じように、そのコンテキストの中でしか意味を持ちません。

そこで:

**モデルが適用されるコンテキストを明示的に定義します。**
**チームの組織、アプリケーションの特定の部分での使用、およびコードベースやデータベーススキーマなどの物理的な表現について、その境界を明示的に設定します。**
**継続的インテグレーションを適用し、モデルの概念や用語をその境界内では整合性が厳密に保たれるようにします。その一方で、境界の外部の問題には気を取られたり、混乱したりしないようにします。**
**コンテキスト内では開発プロセスを一つに標準化します。他のコンテキストでは同じプロセスを使用する必要はありません。**

## ユビキタス言語 Ubiquitous Language

> For first you write a sentence,
> And then you chop it small;
> Then mix the bits, and sort them out
> Just as they chance to fall:
> The order of the phrases makes
> No difference at all.
> —Lewis Carroll, “Poeta Fit, Non Nascitur”

しなやかで知識豊かな設計を生み出すために必要なものは、汎用性が高く、共有されたチーム言語と、ソフトウェアプロジェクトでは滅多に行われないような、言語を用いた活発な実験です。

1つの境界づけられたコンテキストの中でも、言語は、洗練されるモデリングを適用するための努力を損なうような方法で分断されてしまうことがあります。
モデルがチームの技術メンバーのためのUML図を描くためだけにしか使われていないのであれば、そのモデルはDDDの核心である創造的なコラボレーションには貢献していません。

ドメインエキスパートは自身の業界用語を使う一方、技術チームのメンバーはドメインを議論するために調整された独自の設計用言語を使っています。
日々の議論の専門用語は、コード（ソフトウェアプロジェクトの最終的に最も重要な製品）に組み込まれている専門用語とは結びついていません。
また、同じ人であっても、会話と文書では異なる言語を使用しているため、ドメインの最も鋭い表現が、コードや文書では決して捉えることのできない一時的な形でしか現れないこともよくあります。

翻訳はコミュニケーションを鈍らせ、知識を貧血症にします。

しかし、これらの方言のどれもがすべてのニーズには対応できていないため、共通の言語にはなり得ません。

ドメインエキスパートは、ドメインの理解を伝えるのに不器用な用語や構造に異議を唱えるべきです。
開発者は、設計に支障をきたす曖昧さや矛盾に注意すべきです。

システムについて会話するように、モデルに親しんでみましょう。
モデルの要素や相互作用を使って、モデルが許す方法で概念を組み合わせながら、声に出してシナリオを説明してください。
言いたいことをより簡単に言う方法を見つけて、その新しいアイデアをダイアグラムやコードに落とし込んでみましょう。

ユビキタス言語を使えば、モデルは単なる設計の成果物ではなくなります。
モデルは開発者とドメインエキスパートが一緒に行うあらゆることに不可欠なものになります。

そこで:

**モデルを言語のバックボーンとして扱います。**
**チーム内およびコード内のあらゆるコミュニケーションにおいて、その言語を徹底的に行使することをチームに約束してください。**
**境界づけられたコンテキストの中では、この同じ言語を、ダイアグラム、文書、そしてとりわけ会話においても使うようにします。**

**言語を変更することはモデルを変更することでもある、ということを意識しましょう。**

**困難な問題を解決する目的で、別の表現、つまり別のモデルを反映した表現を試してみましょう。**
**その後、クラス、メソッド、モジュールの名前を変更して、新しいモデルに適合するようにコードをリファクタリングします。**
**会話の中での用語の混乱を、普通の言葉の意味に同意するように解決します。**

## 継続的インテグレーション Continuous Integration

> 境界づけられたコンテキストを定義したら、その健全さを維持しなければなりません。

同じ境界づけられたコンテキストの中で多くの人が作業をしている場合、モデルが断片化する傾向が強くなります。
チームが大きければ大きいほど問題も大きくなりますが、3人や4人程度の小さなチームでも深刻な問題に遭遇することがあります。
しかし、システムをさらに小さなコンテキストに分解してしまうと、最終的には、統合と一貫性の貴重な段階を失うことになります。

そこで:

**すべてのコードと他の実装成果物を頻繁にマージするプロセスを導入し、断片化を迅速に検出するための自動化テストを実施します。**
**異なる人々の頭の中で概念が進化していく中で、モデルの共有ビューを徹底議論し生み出すために、ユビキタス言語を絶え間なく行使します。**

## モデル駆動開発 Model-Driven Design

> コードとその基礎となるモデルとを密接に関連付けることは、コードに意味を与え、モデルを適切なものにします。

設計が、あるいは設計の中心部分が、そのドメインモデルと対応付けられていない場合、モデルの価値は低く、ソフトウェアの正確さは疑わしいものとなります。
同様に、モデルと設計機能の対応関係が複雑な場合、理解するのが難しく、実際のところ設計の変化に合わせて保守することは不可能です。
分析と設計の間に致命的な溝が生まれてしまい、それぞれの活動で得られた洞察が他方の活動には生かされないようになってしまいます。

モデルから、設計で使用する専門用語と、責任の基本的な割り振りを導き出してください。
コードはモデルの表現にあたるので、コードへの変更はモデルへの変更になるかもしれません。
その変更の影響は、プロジェクトの活動の残りの部分全体へと広がらなければなりません。

実装をモデルと忠実に結びつけるためには、通常、オブジェクト指向プログラミングのような、モデリングパラダイムをサポートするソフトウェア開発ツールや言語が必要になります。

そこで:

**ソフトウェアシステムの一部分を設計する際には、ドメインモデルがまさに書かれたとおりに反映されているように設計し、ドメインモデルとソフトウェアシステムの対応付けが明らかになるようにします。**
**ドメインへのより深い洞察を反映させようとしているときであっても、より自然な形でソフトウェアに実装できるよう、モデルを再検討し、修正してください。**
**流暢なユビキタス言語をサポートすることに加えて、分析と設計の両方の目的を十分に果たす単一のモデルを要求してください。**

## 実践的モデラー Hands-on Modelers

コードを書いた人たちがモデルに責任を感じていないか、モデルをアプリケーションのために機能させる方法を理解していない場合、モデルはソフトウェアとは何の関係もないものとなります。
コードを変更することでモデルも変更されることを開発者が理解していなければ、リファクタリングはモデルを強化するのではなく、モデルを弱めることになります。
一方、モデラーが実装プロセスから切り離されている場合、モデラーは実装の制約についての感覚を得ることができないか、得たとしてもすぐに失ってしまいます。
モデルが効果的な実装をサポートし、ドメインへの重要な洞察を抽象化するというモデル駆動型設計の基本的な制約は半減し、結果として得られるモデルは非現実的なものになってしまいます。
最後に、モデル駆動設計をコーディングする際の微妙な点を伝えるようなコラボレーションが分業によって妨げられている場合、経験豊富な設計者の知識とスキルは他の開発者に移されません。

そこで:

**モデルに貢献する技術者は、プロジェクトでの主な役割がどのようなものであっても、コードに触れる時間を作らなければなりません。**
**コードを変更する責任のある人は誰でも、コードを通じてモデルを表現することを学ばなければなりません。**
**すべての開発者は、モデルに関する何かしらの議論に参加し、ドメインエキスパートと交流しなければなりません。**
**異なる方法で貢献する人は、ユビキタス言語を使ってモデルのアイデアをダイナミックに交換するために、意識的にコードに触れる人を巻き込む必要があります。**

## より深い洞察へ向かうリファクタリング Refactoring Toward Deeper Insight

実績のある基本的な構成要素（ビルディングブロック）一式を、一貫性のある言語と一緒に使用することで、開発作業にいくばくかの健全さをもたらします。
これにより、ドメインエキスパートの微妙な懸念を捉え、実用的な設計を推進することができるような、鋭いモデルを実際に見つけるという課題が残ります。
表面的なものを取り除き、本質的なものを捉えたモデルは、深いモデルになります。
こうすることで、ソフトウェアはドメインエキスパートの考え方と同調するようになり、ユーザーのニーズにより敏感になるはずです。

伝統的に、リファクタリングは技術的な動機を伴うコード変換の観点から説明されてきました。
リファクタリングは、ドメインへの洞察と、それに対応するモデルまたはコード内の表現を洗練する目的で行われることもあります。

ドメインモデルを洗練させ有用なものにするためには、リファクタリングの反復的なプロセスを経て開発されなければなりません。これにはドメインについての学習に興味のある開発者と、ドメインの専門家が密接に関与することも含みます。
